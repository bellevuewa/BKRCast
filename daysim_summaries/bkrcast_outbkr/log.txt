
R version 4.1.1 (2021-08-10) -- "Kick Things"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ##This is a temporary main control file with lots of TODOs to move 
> ##this whole effort to a package with project specific config and run files
> 
> #Rprof()
> 
> #-----------------------
> #Load packages
> #-----------------------
> ##TODO consider local R installation, with predownloaded packages in that library
> library(foreign)
> library(reshape)
Warning message:
package 'reshape' was built under R version 4.1.2 
> library(XLConnect)
XLConnect 1.0.5 by Mirai Solutions GmbH [aut],
  Martin Studer [cre],
  The Apache Software Foundation [ctb, cph] (Apache POI),
  Graph Builder [ctb, cph] (Curvesapi Java library),
  Brett Woolridge [ctb, cph] (SparseBitSet Java library)
https://mirai-solutions.ch
https://github.com/miraisolutions/xlconnect
Warning message:
package 'XLConnect' was built under R version 4.1.2 
> library(descr)
Warning message:
package 'descr' was built under R version 4.1.2 
> library(Hmisc)
Loading required package: lattice
Loading required package: survival
Loading required package: Formula
Loading required package: ggplot2

Attaching package: 'Hmisc'

The following objects are masked from 'package:base':

    format.pval, units

Warning messages:
1: package 'Hmisc' was built under R version 4.1.2 
2: package 'ggplot2' was built under R version 4.1.2 
> library(data.table)

Attaching package: 'data.table'

The following object is masked from 'package:reshape':

    melt

Warning message:
package 'data.table' was built under R version 4.1.2 
> library(plyr)

Attaching package: 'plyr'

The following objects are masked from 'package:Hmisc':

    is.discrete, summarize

The following objects are masked from 'package:reshape':

    rename, round_any

Warning message:
package 'plyr' was built under R version 4.1.2 
> 
> setwd("D:/P3Test/2020baseyear-BKR/BKR1-20/daysim_summaries/bkrcast_outbkr")
> 
> #------------------------------------
> #Source functions and config settings
> #------------------------------------
> source("utilfunc.R")
> #TODO function in package to create template config file in a specified location
> source("daysim_output_config.R")
> 
> progressStart("run DaySim summaries",14)
> 
> #-----------------------
> #Load data
> #-----------------------
> 
> #Geographical correspondence
> countycorr <- fread(tazcountycorr)
> 
> #Load DaySim outputs into Rdata files
> progressNextStep("reading hh data")
> if(runWrkSchLocationChoice | runVehAvailability | runDayPattern | runTourDestination | runTourMode)
+ {
+   if(prepDaySim)
+     readSaveRdata(dshhfile,"dshhdata")
+   if(prepSurvey)
+     readSaveRdata(surveyhhfile,"survhhdata")
+ }
> 
> progressNextStep("reading person data")
> if(runWrkSchLocationChoice | runDayPattern | runTourDestination | runTourMode | runTourTOD | runTripMode | runTripTOD)
+ {
+   if(prepDaySim)
+     readSaveRdata(dsperfile,"dsperdata")
+   if(prepSurvey)
+     readSaveRdata(surveyperfile,"survperdata")
+ }
> 
> progressNextStep("reading person day data")
> if(runDayPattern)
+ {
+   if(prepDaySim)
+     readSaveRdata(dspdayfile,"dspdaydata")
+   if(prepSurvey)
+     readSaveRdata(surveypdayfile,"survpdaydata")
+ }
> 
> progressNextStep("reading person day tour data")
> if(runDayPattern | runTourDestination | runTourMode | runTourTOD | runTripMode)
+ {
+   if(prepDaySim)
+     readSaveRdata(dstourfile,"dstourdata")
+   if(prepSurvey)
+     readSaveRdata(surveytourfile,"survtourdata")
+ }
> 
> progressNextStep("reading person day trip data")
> if(runDayPattern | runTripMode | runTripTOD)
+ {
+   if(prepDaySim)
+     readSaveRdata(dstripfile,"dstripdata")
+   if(prepSurvey)
+     readSaveRdata(surveytripfile,"survtripdata")
+ }
> 
> #Optional tour weight adjustment
> if(tourAdj)
+ {
+   touradj <- fread(tourAdjFile)
+ }
> 
> #force gc()
> gc()
            used   (Mb) gc trigger   (Mb)  max used   (Mb)
Ncells   1893541  101.2    3714561  198.4   2596467  138.7
Vcells 146808702 1120.1  426597394 3254.7 408035085 3113.1
> 
> #-----------------------
> #Run tabulations
> #-----------------------
> ##TODO split between preparing tables in an R object and then putting them somewhere
> ##TODO e.g. in a spreadsheet, in a pdf report, etc.
> 
> #source("nonhwy.R")
> 
> progressNextStep("summarizing work location choice")
> if(runWrkSchLocationChoice)
+ {
+   source("wrkschlocation.R")
+ }
[1] "Work/School Location Summary...Started"
[1] "Work/School Location Summary...Finished"
> progressNextStep("summarizing vehicle ownership choice")
> if(runVehAvailability)
+ {
+   source("vehavailability.R")
+ }
[1] "Vehicle Availabililty Summary...Started"
[1] "Vehicle Availabililty Summary...Finished"
> progressNextStep("summarizing Day pattern")
> if(runDayPattern)
+ {
+   source("daypattern.R")
+ }
[1] "Day Pattern Summary...Started"
[1] "Day Pattern Summary...Finished"
> progressNextStep("summarizing Destination Choice")
> if(runTourDestination)
+ {
+   source("tourdestination.R")
+ }
[1] "Tour Destination Summary...Started"
[1] "Tour Destination Summary...Finished"
> progressNextStep("summarizing Trip Destination Choice")
> if(runTourDestination)
+ {
+   source("tripdestination.R")
+ }
[1] "Trip Destination Summary...Started"
[1] "Trip Destination Summary...Finished"
> progressNextStep("summarizing Tour Mode Choice") 
> if(runTourMode)
+ {
+   source("tourmode.R")
+ }
[1] "Tour Mode Summary...Started"
[1] "Tour Mode Summary...Finished"
> progressNextStep("summarizing Tour Time of Day Choice") 
> if(runTourTOD)
+ {
+   source("tourtod.R")
+ }
[1] "Tour Time of Day Summary...Started"
[1] "Tour Time of Day Summary...Finished"
> progressNextStep("summarizing Trip Mode Choice") 
> if(runTripMode)
+ {
+   source("tripmode.R")
+ }
[1] "Trip Mode Summary...Started"
[1] "Trip Mode Summary...Finished"
> progressNextStep("summarizing Trip Time of Day Choice")
> if(runTripTOD)
+ {
+   source("triptod.R")
+ }
[1] "Trip Time of Day Summary...Started"
[1] "survey"
[1] "times are in minutes"
[1] "daysim"
[1] "times are in minutes"
[1] "Trip Time of Day Summary...Finished"
> 
> progressEnd(outputsDir)
   steps                            stepnames stepruntimes cumruntimes
1      1                      reading hh data         4.52        4.52
2      2                  reading person data        13.30       17.82
3      3              reading person day data        12.26       30.08
4      4         reading person day tour data        39.69       69.77
5      5         reading person day trip data       104.98      174.75
6      6     summarizing work location choice        14.05      188.80
7      7 summarizing vehicle ownership choice         3.20      192.00
8      8              summarizing Day pattern        61.55      253.55
9      9       summarizing Destination Choice        11.19      264.74
10    10  summarizing Trip Destination Choice        19.78      284.52
11    11         summarizing Tour Mode Choice        10.09      294.61
12    12  summarizing Tour Time of Day Choice        15.97      310.58
13    13         summarizing Trip Mode Choice        22.50      333.08
14    14  summarizing Trip Time of Day Choice        28.91      361.99
> 
> # Rprof(NULL)
> # memprof <- summaryRprof()
> 
> proc.time()
   user  system elapsed 
 772.12  168.57  364.84 
